pipeline {
    agent any

    environment {
        // Define an environment variable to store logs
        LOG_DIR = 'logs'
    }

    stages {
        stage('Build') {
            steps {
                script {
                    sh "mkdir -p ${LOG_DIR}"
                    sh "echo 'Building the code...' > ${LOG_DIR}/build.log"
                }
            }
        }
        stage('Unit and Integration Tests') {
            steps {
                script {
                    sh "echo 'Running unit and integration tests...' > ${LOG_DIR}/tests.log"
                }
            }
        }
        stage('Code Analysis') {
            steps {
                script {
                    sh "echo 'Analyzing the code...' > ${LOG_DIR}/analysis.log"
                }
            }
        }
        stage('Security Scan') {
            steps {
                script {
                    sh "echo 'Scanning the code for vulnerabilities...' > ${LOG_DIR}/security.log"
                }
            }
        }
        stage('Deploy to Staging') {
            steps {
                script {
                    sh "echo 'Deploying to staging...' > ${LOG_DIR}/staging_deploy.log"
                }
            }
        }
        stage('Integration Tests on Staging') {
            steps {
                script {
                    sh "echo 'Running integration tests on staging...' > ${LOG_DIR}/staging_tests.log"
                }
            }
        }
        stage('Deploy to Production') {
            steps {
                script {
                    sh "echo 'Deploying to production...' > ${LOG_DIR}/production_deploy.log"
                }
            }
        }
    }

    post {
        success {
            mail to: "dzassadcass@gmail.com",
                 subject: "Build Status: SUCCESS",
                 body: """
                    The build was successful!
                    
                    Logs:
                    ${LOG_DIR}/build.log
                    ${LOG_DIR}/tests.log
                    ${LOG_DIR}/analysis.log
                    ${LOG_DIR}/security.log
                    ${LOG_DIR}/staging_deploy.log
                    ${LOG_DIR}/staging_tests.log
                    ${LOG_DIR}/production_deploy.log
                    """,
                 attachmentsPattern: '**/*.log'
        }
        failure {
            mail to: "dzassadcass@gmail.com",
                 subject: "Build Status: FAILURE",
                 body: """
                    The build failed!

                    Logs:
                    ${LOG_DIR}/build.log
                    ${LOG_DIR}/tests.log
                    ${LOG_DIR}/analysis.log
                    ${LOG_DIR}/security.log
                    ${LOG_DIR}/staging_deploy.log
                    ${LOG_DIR}/staging_tests.log
                    ${LOG_DIR}/production_deploy.log
                    """,
                 attachmentsPattern: '**/*.log'
        }
    }
}
